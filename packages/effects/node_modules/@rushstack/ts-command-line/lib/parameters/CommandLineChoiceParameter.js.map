{"version":3,"file":"CommandLineChoiceParameter.js","sourceRoot":"","sources":["../../src/parameters/CommandLineChoiceParameter.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport type { ICommandLineChoiceDefinition } from './CommandLineDefinition';\nimport { CommandLineParameterBase, CommandLineParameterKind } from './BaseClasses';\n\n/**\n * The data type returned by {@link CommandLineParameterProvider.(defineChoiceParameter:2)}.\n * @public\n */\nexport interface IRequiredCommandLineChoiceParameter<TChoice extends string = string>\n  extends CommandLineChoiceParameter<TChoice> {\n  readonly value: TChoice;\n}\n\n/**\n * The data type returned by {@link CommandLineParameterProvider.(defineChoiceParameter:1)}.\n * @public\n */\nexport class CommandLineChoiceParameter<TChoice extends string = string> extends CommandLineParameterBase {\n  /** {@inheritDoc ICommandLineChoiceDefinition.alternatives} */\n  public readonly alternatives: ReadonlySet<TChoice>;\n\n  /** {@inheritDoc ICommandLineStringDefinition.defaultValue} */\n  public readonly defaultValue: TChoice | undefined;\n\n  private _value: TChoice | undefined = undefined;\n\n  /** {@inheritDoc ICommandLineChoiceDefinition.completions} */\n  public readonly completions: (() => Promise<ReadonlyArray<TChoice> | ReadonlySet<TChoice>>) | undefined;\n\n  /** {@inheritDoc CommandLineParameter.kind} */\n  public readonly kind: CommandLineParameterKind.Choice = -CommandLineParameterKind.Choice;\n\n  /** @internal */\n  public constructor(definition: ICommandLineChoiceDefinition<TChoice>) {\n    super(definition);\n    const { alternatives, defaultValue, completions } = definition;\n\n    const alternativesSet: Set<TChoice> = alternatives instanceof Set ? alternatives : new Set(alternatives);\n    if (alternativesSet.size < 1) {\n      throw new Error(\n        `When defining a choice parameter, the alternatives list must contain at least one value.`\n      );\n    }\n    if (defaultValue && !alternativesSet.has(defaultValue)) {\n      throw new Error(\n        `The specified default value \"${defaultValue}\"` +\n          ` is not one of the available options: ${alternatives.toString()}`\n      );\n    }\n\n    this.alternatives = alternativesSet;\n    this.defaultValue = defaultValue;\n    this.validateDefaultValue(!!this.defaultValue);\n    this.completions = completions;\n  }\n\n  /**\n   * {@inheritDoc CommandLineParameter._setValue}\n   * @internal\n   */\n  public _setValue(data: unknown): void {\n    // abstract\n    if (data !== null && data !== undefined) {\n      if (typeof data !== 'string') {\n        this.reportInvalidData(data);\n      }\n      this._value = data as TChoice;\n      return;\n    }\n\n    if (this.environmentVariable !== undefined) {\n      // Try reading the environment variable\n      const environmentValue: string | undefined = process.env[this.environmentVariable];\n      if (environmentValue !== undefined && environmentValue !== '') {\n        if (!this.alternatives.has(environmentValue as TChoice)) {\n          const choices: string = '\"' + Array.from(this.alternatives).join('\", \"') + '\"';\n          throw new Error(\n            `Invalid value \"${environmentValue}\" for the environment variable` +\n              ` ${this.environmentVariable}.  Valid choices are: ${choices}`\n          );\n        }\n\n        this._value = environmentValue as TChoice;\n        return;\n      }\n    }\n\n    if (this.defaultValue !== undefined) {\n      this._value = this.defaultValue;\n      return;\n    }\n\n    this._value = undefined;\n  }\n\n  /**\n   * {@inheritDoc CommandLineParameter._getSupplementaryNotes}\n   * @internal\n   */\n  public _getSupplementaryNotes(supplementaryNotes: string[]): void {\n    // virtual\n    super._getSupplementaryNotes(supplementaryNotes);\n    if (this.defaultValue !== undefined) {\n      supplementaryNotes.push(`The default value is \"${this.defaultValue}\".`);\n    }\n  }\n\n  /**\n   * Returns the argument value for a choice parameter that was parsed from the command line.\n   *\n   * @remarks\n   * The return value will be `undefined` if the command-line has not been parsed yet,\n   * or if the parameter was omitted and has no default value.\n   */\n  public get value(): TChoice | undefined {\n    return this._value;\n  }\n\n  /** {@inheritDoc CommandLineParameter.appendToArgList} @override */\n  public appendToArgList(argList: string[]): void {\n    if (this.value !== undefined) {\n      argList.push(this.longName);\n      argList.push(this.value);\n    }\n  }\n}\n"]}